<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<?xcl-stylesheet resource="atg/ui/commerce/scenario/commerce-grammar.xsl"?>
<?xcl-stylesheet resource="atg/ui/scenario/expression/scenario-grammar.xsl"?>
<?xcl-stylesheet resource="atg/ui/expreditor/xcl/grammar.xsl"?>

<!-- ================================================================ -->
<!-- This grammar provides all the elements used in the Scenario      -->
<!-- Editor to generate and edit Commerce-related SDL constructs.     -->
<!-- ================================================================ -->

<context serializable="true">
<!-- ================================================================ -->
<!-- Include the constructs defined in default scenario grammar.      -->
<!-- ================================================================ -->


  <!-- 
       Define the grammar of condition "merchandiseTotalCondition" which allows
       a condition that checks the total amount of items in the order where each 
       item must pass a PMDL rule evaluation
  
       When merchandise total (Less Than | Equal To | Greater Than) (DOUBLE) from items
       where (PMDL rule evaluation)  
       
       The MerchandiseTotalCondition class expects two operands; the first operand is a
       stringified double relating to the total currency amount of the commerce 
       items, while the second is a PMDL rule defining the conditions each item must 
       meet to be included in the accounting operation. 
  -->

  <required-order-sequence id="condition-merchandiseTotalCondition">
    <element-icon>atg/ui/process/images/generic-condition.gif</element-icon>

    <!-- 
     Attach an XML template to this grammar node, specifying the
        SDL that it will emit inside an enclosing <condition> tag.  This
        template says that a <filter operator="moonPhase"> tag should
        enclose all XML generated by children of this grammar node. 
                
        You want this to satisfy the DTD used by the Process Model Language  
      --> 
      
    <xml-template>
      <filter operator="merchandiseTotalCondition">
        <apply-xml-templates /> 
      </filter>
    </xml-template>
      
    <token>
      <description>When merchandise total </description>
      <description-resource>grammar-when-merchandise-total</description-resource>
    </token>

    <!-- 
     Provide a choice of tokens for the amount comparison. 
      --> 
    <choice>
        <!--  ( < | = | >) --> 
        <token>
          <xml-template>
            <constant type="java.lang.Integer">0</constant> 
          </xml-template>
          <description>&lt;</description>
          <description-resource>grammar-less-than</description-resource> 
        </token>
        <token>
          <xml-template>
            <constant type="java.lang.Integer">1</constant> 
          </xml-template>
          <description>=</description>
          <description-resource>grammar-equals</description-resource> 
        </token>
        <token>
          <xml-template>
            <constant type="java.lang.Integer">2</constant> 
          </xml-template>
          <description>&gt;</description> 
          <description-resource>grammar-greater-than</description-resource> 
        </token>
    </choice>

    <token>
      <description> amount </description>
      <description-resource>grammar-amount</description-resource> 
    </token>
    
    <!-- Provide the amount the creator must type in -->
    <literal>
      <!-- XML template for the "value" parameter.  Note that the
           value of the literal will be associated with an XML text
           node processed at the point of <apply-xml-templates/>. -->
      <xml-template>
          <constant><apply-xml-templates/></constant>
      </xml-template>
      <required/>
      <description>Enter an amount</description>
      <description-resource>grammar-enter-an-amount</description-resource> 
      <default><value type="java.lang.Double">0.00</value></default>
    </literal>

    <token>
      <description> from Items where</description>
      <description-resource>grammar-from-items-where</description-resource> 
    </token>

    <!-- Use the commerce item filter expression from DCS -->
    <sequence id="store-commerce-item-filter">
      <expression-class>atg.ui.commerce.scenario.CommerceItemFilterExpression</expression-class>
      <xml-template>
        <constant><apply-xml-templates/></constant>
      </xml-template>
    </sequence>
  </required-order-sequence>                

</context>
<!-- @version $Id: //hosting-blueprint/B2CBlueprint/version/10.2/EStore/src/atg/projects/store/ui/store-expression-grammar.xml#1 $$Change: 735822 $-->
